<!DOCTYPE html>
<html>
<head>
	<title>Socket testing</title>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js"></script>
	<script>
		window.onload = function() {

			var messages = [];

			var socket = io.connect('http://10.0.0.223:8080');

			var field = document.getElementById("field");
			var sendButton = document.getElementById("send");
			var content = document.getElementById("content");
			var name = document.getElementById("name");


			var x;

			socket.on('message', function (data) {
				if(data.message) {
					messages.push(data);
					var html = '';
					for(var i=0; i<messages.length; i++) {
						html += '<b>' + (messages[i].username ? messages[i].username : 'Servidor') + ': </b>';
						html += messages[i].message + '<br />';
					}
					content.innerHTML = html;
				} else {
					console.log("There is a problem:", data);
				}
			});


			socket.emit('newUser', function callback(sess){

				socket.on('message_' + sess, function (data) {
					if(data.message) {
						messages.push(data);
						var html = '';
						for(var i=0; i<messages.length; i++) {
							html += '<b>' + (messages[i].username ? messages[i].username : 'Servidor') + ': </b>';
							html += messages[i].message + '<br />';
						}
						content.innerHTML = html;
					} else {
						console.log("There is a problem:", data);
					}
				});

				x = sess;

				console.log(sess);

			});



			socket.on('invoice', function (data) {
				if(data.status === 'OK') {
					messages.push('invoice inserted');
					var html = '';
					for(var i=0; i<messages.length; i++) {
						html += '<b>' + (messages[i].username ? messages[i].username : 'Servidor') + ': </b>';
						html += messages[i].message + '<br />';
					}
					html += '<b>Servidor</b>';
					html += data + '<br />';
					content.innerHTML = html;
				} else {
					console.log("There is a problem:", data);
				}
			});


			sendButton.onclick = function() {
				if(name.value == "") {
					alert("te falta el nombre");
				} else {
					var text = field.value;
					socket.emit('send', { message: text, username: name.value });
				}
			};

		}
	</script>
</head>
<body>
<input id="name" placeholder="tu nombre" style="width:200px;">
<br/>
<input id="field" style="width:450px;" >
<input id="send" type="button" value='Enviar'>
<br/>
<div id="content"></div>
</body>
</html>