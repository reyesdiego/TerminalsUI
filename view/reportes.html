<div class="container col-xlg-offset-2 col-xlg-8">

<div class="row col-lg-12 page-header">
	<h1><img ng-src="images/reportes.png" height="64" width="64" class="hidden-xs">Reportes</h1>
</div>

<div class="row">
<tabset>

<tab class="hidden-print" heading="Tasas a las cargas">
	<div ng-controller="ratesCtrl">
		<br>
		<accordion-min heading="Filtrar por">
			<div class="col-lg-3 col-sm-6">
				<div class="form-group">
					<div class="input-group">
						<span class="input-group-addon">Tipo</span>
						<select class="form-control" ng-model="modelDetalle.tipo">
							<option value="date" ng-selected="true">Diario</option>
							<option value="month">Mensual</option>
							<option value="year">Anual</option>
						</select>
					</div>
				</div>
			</div>
			<div class="col-lg-4 col-sm-6" ng-show="modelDetalle.tipo == 'date'">
				<div class="form-group">
					<div class="input-group">
						<span class="input-group-addon">Día</span>
						<input type="text" class="form-control" ng-keyup="hitEnter($event)" datepicker-popup="yyyy-MM-dd" ng-model="model.fechaInicio" is-open="openfechaInicio" max-date="maxDate" readonly style="background-color: #ffffff"/>
								<span class="input-group-btn">
									<button class="btn btn-default" ng-click="openDate($event); openfechaInicio = !openfechaInicio;"><span class="glyphicon glyphicon-calendar"></span></button>
								</span>
					</div>
				</div>
			</div>
			<div class="col-lg-4 col-sm-6" ng-show="modelDetalle.tipo == 'month'">
				<div class="form-group">
					<div class="input-group">
						<span class="input-group-addon">Mes</span>
						<input type="text" class="form-control" ng-keyup="hitEnter($event)" datepicker-popup="yyyy-MM" datepicker-mode="'month'" datepicker-options="{minMode: 'month'}" ng-model="model.fechaInicio" is-open="openfechaInicio" max-date="maxDate" readonly style="background-color: #ffffff"/>
								<span class="input-group-btn">
									<button class="btn btn-default" ng-click="openDate($event); openfechaInicio = !openfechaInicio;"><span class="glyphicon glyphicon-calendar"></span></button>
								</span>
					</div>
				</div>
			</div>
			<div class="col-lg-4 col-sm-6" ng-show="modelDetalle.tipo == 'year'">
				<div class="form-group">
					<div class="input-group">
						<span class="input-group-addon">Año</span>
						<input type="text" class="form-control" ng-keyup="hitEnter($event)" datepicker-popup="yyyy" datepicker-mode="'year'" datepicker-options="{minMode: 'year'}" ng-model="model.fechaInicio" is-open="openfechaInicio" max-date="maxDate" readonly style="background-color: #ffffff"/>
								<span class="input-group-btn">
									<button class="btn btn-default" ng-click="openDate($event); openfechaInicio = !openfechaInicio;"><span class="glyphicon glyphicon-calendar"></span></button>
								</span>
					</div>
				</div>
			</div>
			<div class="col-lg-4 col-sm-6">
				<div class="form-group">
					<button class="btn btn-primary" ng-click="cargaRates()">Buscar</button>
				</div>
			</div>
		</accordion-min>
		<div-cargando mostrar="cargando">
			<div ng-hide="rates.length != undefined && rates.length > 0">
				<div-panel config-panel="configPanel">{{ configPanel.mensaje }}</div-panel>
			</div>
			<div ng-show="rates.length != undefined && rates.length > 0">
				<div class="checkbox col-lg-8">
					<input type="checkbox" ng-click="cambioTasa()"> Usar tasa AGP
				</div>
				<div class="table-responsive col-lg-8">
					<table class="table table-striped table-bordered table-hover">
						<thead>
						<tr>
							<th><a href="" ng-click="ordenarPor('terminal')">
								<span class="glyphicon glyphicon-sort-by-attributes" ng-show="predicate == 'terminal' && !reverse"></span>
								<span class="glyphicon glyphicon-sort-by-attributes-alt" ng-show="predicate == 'terminal' && reverse"></span>
								Terminal
							</a></th>
							<th>C&oacute;digo</th>
							<th>Descripci&oacute;n</th>
							<th><a href="" ng-click="ordenarPor('ton')">
								<span class="glyphicon glyphicon-sort-by-attributes" ng-show="predicate == 'ton' && !reverse"></span>
								<span class="glyphicon glyphicon-sort-by-attributes-alt" ng-show="predicate == 'ton' && reverse"></span>
								Toneladas
							</a></th>
							<th class="text-right" ng-hide="tasaAgp"><a href="" ng-click="ordenarPor('total')">
								<span class="glyphicon glyphicon-sort-by-attributes" ng-show="predicate == 'total' && !reverse"></span>
								<span class="glyphicon glyphicon-sort-by-attributes-alt" ng-show="predicate == 'total' && reverse"></span>
								Tasa
							</a></th>
							<th class="text-right" ng-show="tasaAgp"><a href="" ng-click="ordenarPor('totalAgp')">
								<span class="glyphicon glyphicon-sort-by-attributes" ng-show="predicate == 'total' && !reverse"></span>
								<span class="glyphicon glyphicon-sort-by-attributes-alt" ng-show="predicate == 'total' && reverse"></span>
								Tasa
							</a></th>
							<th class="text-right" ng-hide="tasaAgp"><a href="" ng-click="ordenarPor('totalPeso')">
								<span class="glyphicon glyphicon-sort-by-attributes" ng-show="predicate == 'totalPeso' && !reverse"></span>
								<span class="glyphicon glyphicon-sort-by-attributes-alt" ng-show="predicate == 'totalPeso' && reverse"></span>
								Importe
							</a></th>
							<th class="text-right" ng-show="tasaAgp"><a href="" ng-click="ordenarPor('totalPesoAgp')">
								<span class="glyphicon glyphicon-sort-by-attributes" ng-show="predicate == 'totalPesoAgp' && !reverse"></span>
								<span class="glyphicon glyphicon-sort-by-attributes-alt" ng-show="predicate == 'totalPesoAgp' && reverse"></span>
								Importe
							</a></th>
						</tr>
						</thead>
						<tbody>
						<tr ng-repeat="tasa in rates | orderBy : predicate : reverse">
							<td>{{ tasa.terminal }}</td>
							<td>{{ tasa.code }}</td>
							<td style="width: 200px">{{ tasa.descripcion }}</td>
							<td class="text-right">{{ tasa.ton | number: 2 }}</td>
							<td class="text-right" ng-hide="tasaAgp">U$S {{ tasa.total | currency }}</td>
							<td class="text-right" ng-show="tasaAgp">U$S {{ tasa.totalAgp | currency }}</td>
							<td class="text-right" ng-hide="tasaAgp">$ {{ tasa.totalPeso | currency }}</td>
							<td class="text-right" ng-show="tasaAgp">$ {{ tasa.totalPesoAgp | currency }}</td>
						</tr>
						<tr>
							<td colspan="4" class="text-right"><strong>Total</strong></td>
							<td class="text-right" ng-hide="tasaAgp">U$S {{ total | currency }}</td>
							<td class="text-right" ng-show="tasaAgp">U$S {{ totalAgp | currency }}</td>
							<td class="text-right" ng-hide="tasaAgp">$ {{ totalPeso | currency }}</td>
							<td class="text-right" ng-show="tasaAgp">$ {{ totalPesoAgp | currency }}</td>
						</tr>
						</tbody>
					</table>
				</div>
				<div class="col-lg-4 text-center center-block">
					<dynamic-chart
							chart-object="chartTotalesPorTerminal"
							select="selectRow(selectedRow, id)"
							colors="barColors">
					</dynamic-chart>
				</div>
				<div class="col-lg-12 table-responsive">
					<table class="table table-striped table-bordered table-hover">
						<thead>
						<tr>
							<th></th>
							<th class="text-right">BACTSSA</th>
							<th class="text-right">TERMINAL4</th>
							<th class="text-right">TRP</th>
						</tr>
						</thead>
						<tbody>
						<tr>
							<td class="text-right"><strong>Total</strong></td>
							<td ng-repeat="total in chartTotalesPorTerminal.data" class="text-right">$ {{ total[1] | currency }}</td>
						</tr>
						</tbody>
					</table>
				</div>
				<div class="col-lg-12" ng-show="mostrarGrafico">
					<span>
						<strong ng-show="modelDetalle.tipo == 'date'">Días hacia atrás:</strong>
						<strong ng-show="modelDetalle.tipo == 'month'">Meses hacia atrás:</strong>
						<strong ng-show="modelDetalle.tipo == 'year'">Años hacia atrás:</strong>
						<input class="text-right" type="number" min="0" step="1" ng-model="modelDetalle.contarHaciaAtras">
						<button class="btn btn-primary" ng-click="actualizarDetalle()">Actualizar</button>
					</span>
				</div>
				<div class="col-lg-12 text-center" ng-hide="mostrarGrafico">
					<img class="media-object center-block" src="images/loading.gif">
				</div>
				<div class="row" ng-show="mostrarGrafico">
					<div class="col-lg-12 left">
						<dynamic-chart
								chart-object="chartReporteTarifas"
								select="selectRow(selectedRow, id)">
						</dynamic-chart>
					</div>
				</div>
				<div class="row col-lg-12" ng-show="verDetalleTerminal">
					<div class="col-lg-6">
						<dynamic-chart
								chart-object="chartDetallePorTerminalFecha"
								select="selectRow(selectedRow, id)">
						</dynamic-chart>
					</div>
					<div class="col-lg-6">
						<dynamic-chart
								chart-object="chartDetallePorTerminalPeriodo"
								select="selectRow(selectedRow, id)">
						</dynamic-chart>
					</div>
				</div>
				<div class="row col-lg-12 text-right" ng-show="mostrarGrafico">
					<button class="btn btn-success" ng-click="descargarPdf()"><span class="glyphicon glyphicon-download"></span> Descargar PDF</button>
				</div>
			</div>
		</div-cargando>
	</div>
</tab>

<tab class="hidden-print" heading="Totales por tarifa">
	<div ng-controller="reporteTarifasCtrl">
		<div class="visible-print-block">
			<h3>Totales por tarifa</h3>
		</div>
		<br>
		<div class="col-lg-12" ng-show="loadingReporteTarifas">
			<img class="media-object center-block" src="images/loading.gif">
		</div>

		<div ng-show="errorTarifario">
			<div-panel config-panel="configPanel">
				<span>{{ configPanel.mensaje }}</span>
			</div-panel>
		</div>

		<div class="col-lg-12 well hidden-print" ng-hide="mostrarGrafico || loadingReporteTarifas || errorTarifario">
			<div class="row">
				<div class="col-lg-6">
					<label for="fechaInicio">Desde</label>
					<p class="input-group">
						<input type="text" id="fechaInicio" readonly="true" class="form-control" datepicker-popup="yyyy-MM-dd" ng-model="desde" />
								<span class="input-group-btn">
									<button class="btn btn-default" ng-click="isCollapsedDesde = !isCollapsedDesde"><i class="glyphicon glyphicon-calendar"></i></button>
								</span>
					</p>
					<div collapse="isCollapsedDesde">
						<div>
							<datepicker ng-model="desde" show-weeks="false" ng-change="isCollapsedDesde = !isCollapsedDesde" max-date="maxDate"></datepicker>
						</div>
					</div>
				</div>
				<div class="col-lg-6">
					<label for="fechaFin">Hasta</label>
					<p class="input-group">
						<input type="text" id="fechaFin" readonly="true" class="form-control" datepicker-popup="yyyy-MM-dd" ng-model="hasta" />
								<span class="input-group-btn">
									<button class="btn btn-default" ng-click="isCollapsedHasta = !isCollapsedHasta"><i class="glyphicon glyphicon-calendar"></i></button>
								</span>
					</p>
					<div collapse="isCollapsedHasta">
						<div>
							<datepicker ng-model="hasta" show-weeks="false" ng-change="isCollapsedHasta = !isCollapsedHasta" max-date="maxDate"></datepicker>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="row hidden-print col-lg-12" ng-hide="mostrarGrafico || loadingReporteTarifas || errorTarifario">
			<div class="input-group col-lg-12">
				<input type="text" class="form-control" ng-model="search" placeholder="Buscar por código, descripción o tarifa" toupper>
				<span class="input-group-btn"><button class="btn btn-default" ng-click="search = ''"><span class="glyphicon glyphicon-remove-circle"></span></button></span>
			</div>
			<br>
			<div class="checkbox col-lg-4">
				<input type="checkbox" ng-model="tasas" ng-change="recargarPricelist()">Sólo tasa a las cargas
			</div>
			<div class="col-lg-5 text-right">
				<button class="btn btn-primary" ng-click="agregarQuitarTodo(true)">Marcar todo</button>
				<button class="btn btn-warning" ng-click="agregarQuitarTodo(false)">Desmarcar todo</button>
			</div>
			<div class="col-lg-3 text-right">
				<h4 class="text-right">{{ tarifasGraficar.data.length }} tarifas seleccionadas</h4>
			</div>
		</div>

		<div class="row col-lg-12" ng-hide="mostrarGrafico || loadingReporteTarifas || errorTarifario">
			<br>
			<div class="bs-example table-responsive">
				<table class="table table-striped table-bordered table-hover">
					<thead>
					<tr>
						<th><span class="glyphicon glyphicon-bookmark"></span> Código</th>
						<th><span class="glyphicon glyphicon-credit-card"></span> Tarifa</th>
						<th class="text-center"><span class="glyphicon glyphicon-check"></span> Seleccionar</th>
					</tr>
					</thead>
					<tbody>
					<tr style="height:60px" ng-repeat="price in filteredPrices = (selectedList | filter:search) | orderBy: predicate : reverse | emptyToEnd: predicate | startFrom:(currentPage-1)*itemsPerPage | limitTo:itemsPerPage">
						<td class="col-lg-1">{{ price.code }}</td>
						<td class="col-lg-8">{{ price.description | maxLength : 240 }}<a href="" ng-show="(price.description.length > 240)" popover="{{ price.description }}" popover-trigger="mouseenter"> (...)</a></td>
						<td class="col-lg-2 text-center"><input style="width: 24px; height: 24px;" type="checkbox" ng-model="price.graficar" ng-click="agregarGrafico(price)"></td>
					</tr>
					</tbody>
				</table>
			</div>
		</div>

		<div class="row hidden-print" ng-hide="mostrarGrafico || loadingReporteTarifas || errorTarifario">
			<div class="col-lg-10 hidden-xs"><pagination boundary-links="true" total-items="filteredPrices.length" items-per-page="itemsPerPage" ng-model="currentPage" ng-change="pageChanged()" max-size="20" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination></div>
			<div class="col-lg-10 visible-xs"><pagination boundary-links="true" total-items="filteredPrices.length" items-per-page="itemsPerPage" ng-model="currentPage" ng-change="pageChanged()" max-size="5" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination></div>
			<div class="col-lg-2 text-right" style="margin-top: 20px">
				<button class="btn btn-primary" ng-click="armarGraficoTarifas()"><span class="glyphicon glyphicon-asterisk"></span> Cargar gráfico</button>
			</div>
		</div>

		<div class="row col-lg-12" ng-show="mostrarGrafico && !loadingReporteTarifas && !errorTarifario">
			<h3>Del {{ desde | date: 'dd/MM/yyyy' }} al {{ hasta | date: 'dd/MM/yyyy' }}</h3>
		</div>

		<div class="row col-lg-12" ng-show="mostrarGrafico && !loadingReporteTarifas && !errorTarifario">
			<table class="table table-striped table-bordered table-hover">
				<thead>
				<tr>
					<th class="col-lg-1"></th>
					<th class="col-lg-3 text-center" ng-repeat="terminal in tablaGrafico.terminales"><span class="glyphicon glyphicon-credit-card"></span> {{ terminal }}</th>
					<th class="col-lg-2 text-center"><span class="glyphicon glyphicon-plus-sign"></span> Total</th>
				</tr>
				</thead>
				<tbody>
				<tr ng-repeat="tarifa in tablaGrafico.data">
					<td class="text-center"><a href popover="{{ tarifa.description }}" popover-trigger="mouseenter">{{ tarifa.code }}</a></td>
					<td ng-repeat="cantidad in tarifa.conteo track by $index" class="text-center">
						<span ng-show="cantidad==0">-</span>
						<span ng-show="!$last && cantidad>0">U$S {{ cantidad | number:2 }} ({{ tarifa.porcentaje[$index] | number:2 }} %)</span>
						<strong ng-show="$last && cantidad>0">U$S {{ cantidad | number:2 }}</strong></td>
				</tr>
				<tr>
					<td class="text-center"><strong>Totales</strong></td>
					<td ng-repeat="total in totales track by $index" class="text-center"><strong>U$S {{ total | number:2 }}</strong></td>
				</tr>
				</tbody>
			</table>
		</div>

		<div class="row" ng-show="mostrarGrafico && !errorTarifario">
			<div class="col-lg-12 text-center">
				<dynamic-chart
						chart-object="chartReporteTarifas"
						select="selectRow(selectedRowIndexReporteTarifas)">
				</dynamic-chart>
			</div>
		</div>

		<div class="row" ng-show="mostrarGrafico && !errorTarifario">
			<div class="col-lg-6 text-center">
				<dynamic-chart
						chart-object="chartTotalesPorTarifa"
						select="selectRow(selectedRowIndexTotalesTarifas)">
				</dynamic-chart>
			</div>
			<div class="col-lg-6 text-center">
				<dynamic-chart
						chart-object="chartTotalesPorTerminal"
						select="selectRow(selectedRowIndexTotalesTerminal)"
						colors="barColors">
				</dynamic-chart>
			</div>
		</div>

		<div class="row hidden-print" ng-show="mostrarGrafico && !errorTarifario">
			<div class="col-lg-6 text-right">
				<button class="btn btn-primary" ng-click="mostrarGrafico = false"><span class="glyphicon glyphicon-arrow-left"></span> Volver</button>
			</div>
			<div class="col-lg-6">
				<button class="btn btn-success" ng-click="descargarPdf()"><span class="glyphicon glyphicon-download"></span> Descargar PDF</button>
			</div>
		</div>
		<br>
	</div>
</tab>

<tab heading="Facturación por empresa">
	<div ng-controller="facturacionPorEmpresaCtrl">
		<div class="visible-print-block">
			<h3>Facturación por empresa</h3>
		</div>
		<br>
		<div class="col-lg-12">
			<div class="col-lg-3">
				<div class="panel panel-info">
					<div class="panel-heading">
						<h3 class="panel-title">Clientes</h3>
					</div>
					<div class="panel-body" style="max-height: 720px; overflow: scroll">
						<input type="text" class="form-control" ng-model="searchClient" placeholder="Razón Social">
						<h5 ng-repeat="cliente in filteredClientes = (listaClientes | filter: searchClient )"><a href ng-click="clientSelected(cliente)">{{ cliente.nombre }}</a></h5>
					</div>
				</div>
				<h6><strong>Total empresas: {{ listaClientes.length }}</strong></h6>
			</div>
			<div class="col-lg-9">
				<reporte-empresas-search model="model" ranking="ranking"></reporte-empresas-search>
				<div class="col-lg-12">
					<div-panel config-panel="mensajeResultado" ng-show="model.clients.length > 0">
						<div>{{ model.clients.length }} clientes seleccionados:</div>
						<div>
							<span ng-repeat="cliente in model.clients">
								<div style="width: auto; float:left; text-align:center"><a href ng-click="quitarCliente(cliente)"> {{ cliente }}</a><span ng-show="!$last"> -&nbsp</span></div>
							</span>
						</div>
					</div-panel>
				</div>
				<div class="col-lg-12" ng-show="cargando">
					<img class="media-object center-block" src="images/loading.gif">
				</div>
				<div class="col-lg-12" ng-hide="cargando || resultados.length > 0">
					<div-panel config-panel="mensajeResultado">
						<span>{{ mensajeResultado.mensaje }}</span>
					</div-panel>
				</div>
				<div class="col-lg-12" ng-hide="cargando || resultados.length == 0">
					<div class="table-responsive">
						<table class="table table-striped table-bordered table-hover">
							<thead>
							<tr>
								<th>CUIT</th>
                                <th>Razón social</th>
								<th class="text-right">Comprobantes</th>
								<th class="text-right">Porcentaje</th>
								<th class="text-right">Promedio</th>
                                <th class="text-right">Máxima</th>
								<th class="text-right">Total</th>
							</tr>
							</thead>
							<tbody>
							<tr ng-repeat="total in resultados">
                                <td>{{ total.cuit }}</td>
								<td>{{ total.razon }}</td>
								<td class="text-right">{{ total.cnt }}</td>
								<td class="text-right">% {{ total.total*100/totalTerminal | number: 2 }}</td>
								<td class="text-right">$ {{ total.avg | currency }}</td>
                                <td class="text-right">$ {{ total.max | currency }}</td>
								<td class="text-right">$ {{ total.total | currency }}</td>
							</tr>
							<tr>
								<td colspan="4" class="text-right"><strong>Total facturado por la terminal en el período</strong></td>
								<td class="text-right">$ {{ totalTerminal | currency }}</td>
							</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="col-lg-12" ng-hide="cargando || resultados.length == 0">
				<div class="col-lg-6">
					<dynamic-chart
							chart-object="chartReporteEmpresas"
							select="selectRow(selectedRowIndexReporteEmpresas)">
					</dynamic-chart>
				</div>
				<div class="col-lg-6">
					<dynamic-chart
							chart-object="chartPorcentaje"
							select="selectRow(selectedRowIndexPorcentaje)">
					</dynamic-chart>
				</div>
			</div>
			<div class="col-lg-12 text-right" ng-hide="cargando || resultados.length == 0">
				<button class="btn btn-success" ng-click="descargarPdf()"><span class="glyphicon glyphicon-download"></span> Descargar PDF</button>
			</div>
		</div>
	</div>
</tab>

</tabset>
</div>

</div>